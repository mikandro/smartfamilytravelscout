# Logrotate configuration for SmartFamilyTravelScout
#
# This file provides system-level log rotation using the logrotate utility.
# It's an alternative or complement to application-level rotation.
#
# Installation:
# 1. Copy this file to /etc/logrotate.d/smartfamilytravelscout
#    sudo cp deployment/logrotate.conf /etc/logrotate.d/smartfamilytravelscout
#
# 2. Ensure log directory has correct permissions:
#    sudo mkdir -p /var/log/smartfamilytravelscout
#    sudo chown -R <app-user>:<app-group> /var/log/smartfamilytravelscout
#
# 3. Test the configuration:
#    sudo logrotate -d /etc/logrotate.d/smartfamilytravelscout
#
# 4. Force rotation manually (for testing):
#    sudo logrotate -f /etc/logrotate.d/smartfamilytravelscout

# Application logs
/var/log/smartfamilytravelscout/*.log {
    # Rotate daily
    daily

    # Keep 7 days of logs
    rotate 7

    # Compress rotated logs
    compress

    # Delay compression until next rotation (allows apps to finish writing)
    delaycompress

    # Don't error if log file is missing
    missingok

    # Don't rotate empty log files
    notifempty

    # Create new log file after rotation with these permissions
    create 0640 www-data www-data

    # Date format in rotated filename (e.g., app.log-20240115)
    dateext
    dateformat -%Y%m%d

    # Use date as extension instead of number
    extension .log

    # Rotate based on size as well (10MB)
    size 10M

    # Run these commands after rotation
    postrotate
        # Reload application if using systemd
        # systemctl reload smartfamilytravelscout || true

        # Or send signal to reload logs
        # kill -USR1 $(cat /var/run/smartfamilytravelscout.pid) || true
    endscript

    # Shared scripts for all log files
    sharedscripts
}

# Error logs - keep longer
/var/log/smartfamilytravelscout/error.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0640 www-data www-data
    dateext
    dateformat -%Y%m%d
    size 10M
    sharedscripts
}

# Celery logs
/var/log/smartfamilytravelscout/celery*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 www-data www-data
    dateext
    dateformat -%Y%m%d
    size 10M
    sharedscripts
}
